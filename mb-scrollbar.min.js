/*
 * mb-scrollbar v2.1.0
 * Plugin for AngularJS
 * (c) 2014 Matthew Balmer http://mattbalmer.com
 * License: MIT
 */
angular.module("mb-scrollbar",[]).directive("mbScrollbar",function(){return{restrict:"A",transclude:!0,scope:{config:"=mbScrollbar"},template:"<div class='ngscroll-resizable' style='position: relative; width: 100%; height: 100%;'> <div class='ngscroll-container' style='width: 100%; height: 100%;' ng-transclude></div> <div class='ngscroll-scrollbar-container' ng-style='styles.scrollbarContainer'><div class='ngscroll-scrollbar' ng-style='styles.scrollbar'></div></div> </div>",link:function(o,r){function e(o,r){return"horizontal"==l.direction?r:o}function n(o,r){for(var e in r)(r||{}).hasOwnProperty(e)&&(o||{}).hasOwnProperty(e)&&(o[e]="object"==typeof o[e]?n(o[e],r[e]):r[e]);return o}function i(o){var r="margin-"+l.position,e=parseInt(a.css(r)||0)+o;s(e)}function s(o){var r="margin-"+l.position,n=Math.min(0,Math.max(o,-b+d)),i=-n/b;a.css(r,n+"px"),u.css(l.position,i*d+l.scrollbar.margin+"px"),c.css(r,e(-n,0)+"px")}var l={autoResize:!1,direction:(o.config||{}).direction||"vertical",scrollbar:{width:6,hoverWidth:8,color:"rgba(0,0,0,.6)",show:!1},scrollbarContainer:{width:12,color:"rgba(0,0,0,.1)"},dragSpeedModifier:1,firefoxModifier:40,scrollTo:(o.config||{}).scrollTo||null};l.dimension=e("height","width"),l.rDimension=e("width","height"),l.position=e("top","left"),l.rPosition=e("right","bottom"),l=n(l,o.config||{}),l.scrollbar.margin=(l.scrollbarContainer.width-l.scrollbar.width)/2,l.scrollbar.hoverMargin=(l.scrollbarContainer.width-l.scrollbar.hoverWidth)/2;var t,a=angular.element(r[0].querySelector(".ngscroll-container")),c=angular.element(r[0].querySelector(".ngscroll-scrollbar-container")),u=angular.element(c.children()[0]),d=0,b=0;o.styles={scrollbar:{position:"absolute",cursor:"default",opacity:l.scrollbar.show?1:0,background:l.scrollbar.color,"border-radius":l.scrollbar.width/2+"px"},scrollbarContainer:{position:"absolute",transition:"background .3s ease-in-out","border-radius":l.scrollbarContainer.width/2+"px"}},u.css(l.rDimension,l.scrollbar.width+"px"),u.css(l.rPosition,l.scrollbar.margin+"px"),u.css(l.position,l.scrollbar.margin+"px"),c.css(l.rPosition,"0"),c.css(l.position,"0"),c.css(l.dimension,"100%"),c.css(l.rDimension,l.scrollbarContainer.width+"px");var h=function(){e(function(){a.css("height","auto"),b=a[0].scrollHeight||0},function(){b=0;for(var o=a.children(),r=0;o.length>r;r++)b+=o[r].offsetWidth})(),d=e(r[0].offsetHeight,r[0].offsetWidth),l.dragSpeedModifier=Math.max(1,1/(t/d)),a.css(l.dimension,b+"px"),d>b&&(b=d),t=d/b*d-2*l.scrollbar.margin,u.css(l.dimension,t+"px"),u.css("transition","opacity .3s ease-in-out, border-radius .1s linear, "+l.rDimension+" .1s linear, "+l.rPosition+" .1s linear"),null==l.scrollTo?i(0):"start"==l.scrollTo?s(0):"end"==l.scrollTo?s(-b+d):s(-parseInt(l.scrollTo))};l.autoResize===!0&&(a.on("DOMNodeInserted",h),a.on("DOMNodeRemoved",h)),o.$on("recalculateMBScrollbars",function(){setTimeout(function(){h()},5)}),o.$on("scrollToMBScrollbars",function(o,r){setTimeout(function(){s(r)},5)}),a.on("mousewheel",function(o){o.preventDefault(),void 0!=o.originalEvent&&(o=o.originalEvent);var r=e(o.wheelDeltaY||o.wheelDelta,o.wheelDeltaX||o.wheelDeltaY||o.wheelDelta);i(r)}),window.navigator.userAgent.toLowerCase().indexOf("firefox")>=0&&a.on("wheel",function(o){o.preventDefault(),void 0!=o.originalEvent&&(o=o.originalEvent);var r=e(o.deltaY,o.deltaX>0?o.deltaX:o.deltaY);return i(-r*l.firefoxModifier),!1});var f,g;u.on("mousedown",function(o){return o.preventDefault(),f=!0,angular.element(document).on("mouseup",function(){f=!1,l.scrollbar.show||u.css("opacity",0)}),g=e(o.screenY,o.screenX),!1}),angular.element(document).on("mousemove",function(o){if(f){o.preventDefault();var r=e(o.screenY,o.screenX)-g;r*=l.dragSpeedModifier,g+=r*(t/d),i(-r)}}),l.scrollbar.show||(r.on("mouseenter",function(){u.css("opacity",1)}),c.on("mouseenter",function(){u.css("opacity",1)}),r.on("mouseleave",function(){f||u.css("opacity",0)})),c.on("mouseenter",function(){c.css("background",l.scrollbarContainer.color),u.css(l.rDimension,l.scrollbar.hoverWidth+"px"),u.css(l.rPosition,l.scrollbar.hoverMargin+"px"),u.css("border-radius",l.scrollbar.hoverWidth/2+"px")}),c.on("mouseleave",function(){c.css("background","none"),u.css(l.rDimension,l.scrollbar.width+"px"),u.css(l.rPosition,l.scrollbar.margin+"px"),u.css("border-radius",l.scrollbar.width/2+"px")}),h()}}}).service("mbScrollbar",function(){this.recalculate=function(o){setTimeout(function(){o.$broadcast("recalculateMBScrollbars")},5)},this.scrollTo=function(o,r){setTimeout(function(){o.$broadcast("scrollToMBScrollbars",r)},5)}});